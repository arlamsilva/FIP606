{
  "hash": "570d0d391b1f84a71a5eef5f4768f256",
  "result": {
    "markdown": "---\ntitle: \"Aula9\"\nauthor: \"ARLAM\"\nformat: html\neditor: visual\n---\n\n\n# Introdução\n\nNesta seção trataremos de formas de análisar dados em experimentos onde as causas da variação na resposta são controladas o máximo possível e o erro experimental minimizado. Veremos os tipos de análise de acordo com o número e tipo de variáveis independentes (níveis do fator) e também o número de tratamentos ou grupos a serem comparados. Iniciaremos primeiramente com os casos mais simples quanto ao número de grupos e iremos avançando conforme aumentamos a complexidade do experimento bem com algumas variações possíveis quanto ao número e tipo de variáveis resposta de interesse.\n\n# Dois tratamentos independentes\n\nUm pesquisador conduziu um experimento com o objetivo de avaliar o efeito de um micronutriente, o magnésio (Mg), adicionado na solução do solo cultivado com plantas de arroz, no manejo de uma doença fúngica. O experimento foi conduzido em delineamento inteiramente casualizado com 10 repetições, sendo cada repetição um vaso de planta. Um dos tratamentos é o chamado controle, ou testemunha, sem o suplemento mineral. O segundo é aquele com o suplemento do Mg na dose de 2 mM. Em cada uma das repetições foi obtido um valor médio do comprimento de lesões em um determinado tempo após a inoculação.\n\n## Preparo pré-análise\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-1_d7e6bb476904f0a2278b68d6e3fed859'}\n\n```{.r .cell-code}\nlibrary(magrittr) # para usar pipes\nlibrary(ggplot2) # para gráficos\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggplot2' was built under R version 4.2.3\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'dplyr' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(tidyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'tidyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:magrittr':\n\n    extract\n```\n:::\n:::\n\n\nDados no formato excel, então iremos utilizar o pacote *readxl*\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-2_1ef62f83c6b98e2a78056cf6b948dce9'}\n\n```{.r .cell-code}\ndata_mg <- read_excel(\"C:dados-diversos.xlsx\")\nhead(data_mg)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  trat    rep  comp\n  <chr> <dbl> <dbl>\n1 Mg2       1   9  \n2 Mg2       2  12.5\n3 Mg2       3  10  \n4 Mg2       4   8  \n5 Mg2       5  13.2\n6 Mg2       6  11  \n```\n:::\n:::\n\n\nA maneira mais simples é visualizar, no caso de mais de 6 repetições, usando boxplots juntamente com os dados de cada repetição.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-3_b3654147f737328f84de54fb62a92fa8'}\n\n```{.r .cell-code}\ndata_mg %>%\n  ggplot(aes(trat, comp)) +\n  geom_boxplot(outlier.color = NA) +\n  geom_jitter(width = 0.1, shape = 1)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nVamos obter estatísticas que descrevem o conjunto, seja a tendência central ou a dispersão dos dados. No caso, será a média, variância, desvio padrão, erro padrão e intervalo de confiança - esse último para inferência visual.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-4_fe8c767b88b78fb761abb5c89400aeb3'}\n\n```{.r .cell-code}\ndat2 <- data_mg %>%\n  group_by(trat) %>%\n  summarise(\n    mean_comp = mean(comp),\n    sd_comp = sd(comp),\n    var_comp = var(comp),\n    n = n(),\n    se_comp = sd_comp / sqrt(n - 1),\n    ci = se_comp * qt(0.025, df = 9) # paramétrico\n  )\ndat2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 7\n  trat    mean_comp sd_comp var_comp     n se_comp     ci\n  <chr>       <dbl>   <dbl>    <dbl> <int>   <dbl>  <dbl>\n1 Mg2          10.5    1.54     2.39    10   0.515 -1.16 \n2 control      15.7    1.27     1.61    10   0.424 -0.958\n```\n:::\n:::\n\n\nJá podemos visualizar os dados com as estatísticas calculadas. Abaixo, as barras verticais represntam o intervalo de confiança 95%.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-5_7375742b5a4f77e0008cb7b10c68c3dd'}\n\n```{.r .cell-code}\ndat2 %>%\n  ggplot(aes(trat, mean_comp)) +\n  geom_jitter(\n    data = data_mg, aes(trat, comp),\n    color = \"grey\",\n    width = 0.05\n  ) +\n  geom_errorbar(aes(\n    ymin = mean_comp - ci,\n    ymax = mean_comp + ci\n  ),\n  width = 0.05\n  ) +\n  geom_point(size = 3)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nO conjunto está no formato largo, assim a variável resposta de interesse está apenas em uma coluna. Existem várias formas de separar em dois vetores os dados de resposta para cada tratamento. Uma delas é por meio da função `spread` do pacote `tidyr`, a qual coloca as respostas em duas colunas, uma para cada tratamento. Vamos criar o conjunto `data_mg2`.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-6_a7149a46557a8119fab236dd8d42ad11'}\n\n```{.r .cell-code}\ndata_mg2 <- data_mg %>%\n  spread(trat, comp)\ndata_mg2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 3\n     rep control   Mg2\n   <dbl>   <dbl> <dbl>\n 1     1    13.7   9  \n 2     2    15.9  12.5\n 3     3    15.7  10  \n 4     4    14.2   8  \n 5     5    15.9  13.2\n 6     6    16.5  11  \n 7     7    18    10.8\n 8     8    14.4   9.5\n 9     9    16.4  10.8\n10    10    16    10.4\n```\n:::\n:::\n\n\n## Análise inferencial\n\nUsando o conjunto original, vamos visualizar as respostas (tamanho da lesão) para cada tratamento, já que O `ggplot2` requer os dados no formato largo.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-7_32c68df1b3028e22fe3360431f5dee5b'}\n\n```{.r .cell-code}\n# usando pipes\ndata_mg %>%\n  ggplot(aes(trat, comp)) +\n  geom_jitter(width = 0.1, height = 0) +\n  ylim(5, 20) # ajusta o eixo y para melhor visualização\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### Homocedasticidade\n\nNo caso de dois grupos, a função que pode ser usada é a `var.test` do R. Vamos usar o formato largo e chamar os dois vetores do conjunto. Verifique o P-valor na saída da análise.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-8_9e2a1d74a33d13db9ab355c26c4ce8f4'}\n\n```{.r .cell-code}\nattach(data_mg2) # vamos facilitar o uso dos vetores\nvar.test(Mg2, control)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tF test to compare two variances\n\ndata:  Mg2 and control\nF = 1.4781, num df = 9, denom df = 9, p-value = 0.5698\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.3671417 5.9508644\nsample estimates:\nratio of variances \n          1.478111 \n```\n:::\n:::\n\n\n### Normalidade\n\nA normalidade pode ser testada por meio de procedimentos visuais e testes específicos.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-9_3a0e817a72d71da3ff95316752d75f1f'}\n\n```{.r .cell-code}\nshapiro.test(Mg2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  Mg2\nW = 0.97269, p-value = 0.9146\n```\n:::\n\n```{.r .cell-code}\nshapiro.test(control)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  control\nW = 0.93886, p-value = 0.5404\n```\n:::\n:::\n\n\nAnálise visual da premissa de normalidade.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-10_ffc1ff05d6509a5b29700b2600e68e4c'}\n\n```{.r .cell-code}\nqqnorm(Mg2)\nqqline(Mg2)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(control)\nqqline(control)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-11_fd1e6a90a270a5efc73bc3b00679640c'}\n\n```{.r .cell-code}\nmagnesio3 <- data_mg %>%\n  group_by(trat) %>%\n  summarize(\n    mu = mean(comp),\n    sd = sd(comp),\n    n = length(comp),\n    se = sd / sqrt(n),\n    ciu = mu + (qt(0.025, df = n - 1) * se),\n    cil = mu - (qt(0.025, df = n - 1) * se)\n  )\n```\n:::\n\n\n### Intervalo de confiança\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-12_96318b9a5240ca77e52250f1e5f024a6'}\n\n```{.r .cell-code}\nmagnesio3 %>%\n  ggplot(aes(trat, mu, color = trat)) +\n  geom_point(size = 3) +\n  ylim(7,20)+\n  geom_errorbar(aes(min = cil, max = ciu), width = 0.05, size = 1) +\n  labs(x = \"Tratamento\", y = \"Valor\", title = \"Magnesium effect on lesion expansion\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Teste de hipótese\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-13_d4542c5b92a9d2bde0c5645b44079662'}\n\n```{.r .cell-code}\nt.test(Mg2, control, paired = F)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  Mg2 and control\nt = -8.1549, df = 17.354, p-value = 2.423e-07\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -6.490393 -3.825607\nsample estimates:\nmean of x mean of y \n   10.520    15.678 \n```\n:::\n:::\n\n\n### Alternativas\n\nSe as premissas de normalidade não fossem atendidas, qual o teste que poderia ser usado? Nesse caso de dois grupos há duas possibilidades, uma é usar um teste não paramétrico ou um teste baseado em reamostragem (bootstrapping) dos dados, os quais independem do modelo de distribuição.\n\nUsando os mesmos dados podemos notar que o resultado é idêntico porém com P-valores diferentes.\n\n# Dois tratamentos dependentes\n\nUm experimento foi conduzido para avaliar o efeito do uso da escala na acurácia e precisão de avaliações visuais de severidade por avaliadores. A hipótese a ser testada foi que avaliações utilizando uma escala digramática como auxílio são mais acuradas do que sem o uso do auxílio. Dez avaliadores foram escolhidos aleatoriamente e fizeram duas avaliações cada. Cinco variáveis que compõe a medida da concordância das estimativas foram obtidas. Uma vez que as medidas foram repetidas no tempo para cada avaliador, as amostras são do tipo dependentes.\n\n## Preparo pré-análise\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-14_7fe0ffa9a21e796b818439c83103edd6'}\n\n```{.r .cell-code}\nescala <- read_excel(\"dados-diversos.xlsx\", \"escala\")\nhead(escala)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  assessment rater acuracia precisao vies_geral vies_sistematico vies_constante\n  <chr>      <chr>    <dbl>    <dbl>      <dbl>            <dbl>          <dbl>\n1 Unaided    A        0.809    0.826      0.979            1.19         0.112  \n2 Unaided    B        0.722    0.728      0.991            0.922       -0.106  \n3 Unaided    C        0.560    0.715      0.783            1.16         0.730  \n4 Unaided    D        0.818    0.819      0.999            0.948       -0.00569\n5 Unaided    E        0.748    0.753      0.993            1.10         0.0719 \n6 Unaided    F        0.695    0.751      0.925            0.802        0.336  \n```\n:::\n:::\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-15_a2a78bf851090a5224803fcc98e6c792'}\n\n```{.r .cell-code}\nescala %>%\n  gather(component, statistics, 3:7) %>% # formato longo\n  ggplot(aes(reorder(assessment, statistics), statistics)) +\n  geom_jitter(width = 0.05) +\n  facet_wrap(~component, scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nPrepara os dados para análise. Cria os vetores de cada grupo para cada variável. Vamos fazer abaixo para acurácia.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-16_b6a3f7777d0c213b0334c20f60e4e2b8'}\n\n```{.r .cell-code}\n# arruma os dados\nescala2 <- select(escala, assessment, rater, acuracia)\nescala3 <- spread(escala2, assessment, acuracia)\n```\n:::\n\n\n### Premissas\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-17_7b5959d22f96d7bfacbf5326d3be8879'}\n\n```{.r .cell-code}\n## homocedasticidade dois grupos\nattach(escala3)\nvar.test(Aided1, Unaided)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tF test to compare two variances\n\ndata:  Aided1 and Unaided\nF = 0.17041, num df = 9, denom df = 9, p-value = 0.01461\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.04232677 0.68605885\nsample estimates:\nratio of variances \n         0.1704073 \n```\n:::\n\n```{.r .cell-code}\n## normalidade\nshapiro.test(Aided1)$p.value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4260888\n```\n:::\n\n```{.r .cell-code}\nshapiro.test(Unaided)$p.value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1131276\n```\n:::\n\n```{.r .cell-code}\nqqnorm(Aided1)\nqqline(Aided1)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(Unaided)\nqqline(Unaided)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-17-2.png){width=672}\n:::\n:::\n\n\n### Análise inferencial\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-18_35437ad61fa64eedcd570e358db39140'}\n\n```{.r .cell-code}\nescala4 <- summarize(group_by(escala2, assessment),\n  mu = mean(acuracia),\n  sd = sd(acuracia),\n  n = length(acuracia),\n  se = sd / sqrt(n),\n  ciu = mu + (qt(0.025, df = n - 1) * se),\n  cil = mu - (qt(0.025, df = n - 1) * se)\n)\n```\n:::\n\n\nVisualiza média e intervalo de confiança\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-19_700787c03434f262ba42ddc055f4f3df'}\n\n```{.r .cell-code}\nggplot(escala4, aes(assessment, mu)) +\n  geom_point(stat = \"identity\", size = 4) +\n  geom_errorbar(aes(min = cil, max = ciu),\n    width = .05\n  )\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nVisualiza cada avaliador\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-20_d235dae8a167b84d7507887cd4b432b4'}\n\n```{.r .cell-code}\nggplot(escala2, aes(reorder(assessment, acuracia), acuracia, group = rater)) + geom_point(stat = \"identity\", size = 3, shape = 1) +\n  geom_line(size = 1, color = \"gray70\") + facet_wrap(~rater, nrow = 5)\n```\n\n::: {.cell-output-display}\n![](aula9_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n### Teste t paramétrico\n\nNote que as amostras são pareadas - mesmo avaliador em dois tempos, portanto há dependência.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-21_c1b418c8b1abf504e45e0b272fc487cb'}\n\n```{.r .cell-code}\n## teste t para amostras pareadas\nt_escala <- t.test(escala3$Aided1, escala3$Unaided,\n  paired = TRUE,\n  var.equal = F\n)\n\nt_escala\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPaired t-test\n\ndata:  escala3$Aided1 and escala3$Unaided\nt = 5.9364, df = 9, p-value = 0.000219\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n 0.1144707 0.2554241\nsample estimates:\nmean difference \n      0.1849474 \n```\n:::\n:::\n\n\n### Teste não paramétrico\n\nPesquise sobre o teste de Wilcoxon.\n\n\n::: {.cell hash='aula9_cache/html/unnamed-chunk-22_e94fcf5621fe77971a0242a8547a7ed4'}\n\n```{.r .cell-code}\nwilcox.test(escala3$Aided1, escala3$Unaided, paired = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWilcoxon signed rank exact test\n\ndata:  escala3$Aided1 and escala3$Unaided\nV = 55, p-value = 0.001953\nalternative hypothesis: true location shift is not equal to 0\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}